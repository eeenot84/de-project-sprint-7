# Проект 7-го спринта

### Описание
Репозиторий предназначен для сдачи проекта 7-го спринта

### Как работать с репозиторием
1. В вашем GitHub-аккаунте автоматически создастся репозиторий `de-project-sprint-7` после того, как вы привяжете свой GitHub-аккаунт на Платформе.
2. Скопируйте репозиторий на свой компьютер. В качестве пароля укажите ваш `Access Token`, который нужно получить на странице [Personal Access Tokens](https://github.com/settings/tokens)):
	* `git clone https://github.com/{{ username }}/de-project-sprint-7.git`
3. Перейдите в директорию с проектом: 
	* `cd de-project-sprint-7`
4. Выполните проект и сохраните получившийся код в локальном репозитории:
	* `git add .`
	* `git commit -m 'my best commit'`
5. Обновите репозиторий в вашем GutHub-аккаунте:
	* `git push origin main`

### Структура репозитория
Вложенные файлы в репозиторий будут использоваться для проверки и предоставления обратной связи по проекту. Поэтому постарайтесь публиковать ваше решение согласно установленной структуре — так будет проще соотнести задания с решениями.

Внутри `src` расположены две папки:
- `/src/dags` - DAG файлы для Airflow;
- `/src/sql` - скрипты для построения витрин данных.

## Структура Data Lake

### Исходные данные (Bronze Layer)
- **Путь**: `/user/master/data/geo/events`
- **Формат**: Parquet
- **Описание**: Таблица событий с добавленными полями широты и долготы для исходящих сообщений
- **Обновление**: Постоянное (streaming или batch по расписанию)

- **Путь**: `/user/master/data/geo/cities`
- **Формат**: CSV (загружен из geo.csv)
- **Описание**: Координаты центров городов Австралии
- **Обновление**: Редко (при добавлении новых городов)

### Обработанные данные (Silver Layer)
- **Путь**: `/user/master/data/geo/events_enriched`
- **Формат**: Parquet
- **Описание**: События с обогащенными данными (определение города по координатам)
- **Обновление**: Ежедневно

### Витрины данных (Gold Layer)

#### Витрина в разрезе пользователей
- **Путь**: `/user/master/data/geo/user_mart`
- **Формат**: Parquet (партиционирование по дате)
- **Поля**: user_id, act_city, home_city, travel_count, travel_array, local_time
- **Обновление**: Ежедневно (после обработки событий)

#### Витрина в разрезе зон
- **Путь**: `/user/master/data/geo/zone_mart`
- **Формат**: Parquet (партиционирование по month, week)
- **Поля**: month, week, zone_id, week_message, week_reaction, week_subscription, week_user, month_message, month_reaction, month_subscription, month_user
- **Обновление**: Еженедельно (агрегация за неделю и месяц)

#### Витрина рекомендации друзей
- **Путь**: `/user/master/data/geo/friends_recommendation_mart`
- **Формат**: Parquet (партиционирование по processed_dttm)
- **Поля**: user_left, user_right, processed_dttm, zone_id, local_time
- **Обновление**: Ежедневно (для актуальных рекомендаций)

### Тестовые данные
- **Путь**: `/user/master/data/geo/test`
- **Формат**: Parquet
- **Описание**: Семплы данных для разработки и отладки
- **Обновление**: По необходимости

